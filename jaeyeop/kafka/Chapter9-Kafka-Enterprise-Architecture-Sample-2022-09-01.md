# 엔터프라이즈 카프카 아키텍처 구성 사례
- 엔터프라이즈용 카프카 아키텍처를 설계 및 구성 실습
    - 스키마 레지스트리와 프로듀서, 컨슈머를 이용해 메시징
    - 카프카 커넥트를 이용해 2개의 카프카 클러스터를 미러링
    - 모니터링 시스템 구성

## 12.1 엔터프라이즈용 카프카 아키텍처의 개요
- 미러 메이커 2.0을 설명하면서도 언급했지만, 엔터프라이즈 환경에서는 장애 복구 등을 위해 하나 이상의 데이터 센터를 운영, 관리하는 경우가 많다.
- 카프카 클러스터 역시 다수의 데이터 센터에 배치
- 카프카와 카프카 간의 데이터 리플리케이션은 필수
- 카프카 간의 데이터 리플리케이션은 주로 미러 메이커 2.0 사용
- 업스트림 카프카에서는 실시간 처리를 하고 다운스트림 카프카를 미러 메이커를 통해 리플리케이션 한 후 다운스트림 카프카에 다양한 Application을 Consume하여 2차 처리를 하는 아키텍쳐로도 많이 사용한다.
- 그림 12-3 카프카 엔터프라이즈 환경 구성도
    - 이건 그냥 보면 이해됨
- 업스트림 카프카와 다운스트림 카프카는 CMAK(Cluster Manager for Apache Kafka)를 이용해 카프카의 토픽들을 관리할 수 있다.

## 12.2 엔터프라이즈용 카프카의 환경 구성
- 책에서는 서버 6대로 엔터프라이즈 환경의 카프카 클러스터를 구성한다.
- 구성요소
    - 주키퍼(3)
    - 업스트림 카프카(3)
    - 다운스트림 카프카(3)
    - 스키마 레지스트리(1)
    - CMAK
    - 카프카 커넥트 - 미러메이커 2.0(3)
    - 엘라스틱서치
    - 키바나
    - 모니터링(PG)
- 그림 12-4 실습에 사용할 서버당 필요한 애플리케이션을 배치한 구성도이다.
- 주키퍼는 2개의 앙상블을 구성하지 않고 1개의 앙상블만 구성하고 지노드(Znode)를 분리해 카프카 클러스터 2개가 하나의 주키퍼 앙상블을 바라보도록 구성했다.
- 카프카 커넥트의 위치는 업스트림이 아닌 다운스트림 카프카에 있음
    - Producer가 Consumer보다 네트워크 장애에 더욱 민감하고 메시지가 유실될 가능성이 있다.


## 12.3 엔터프라이즈용 카프카의 운영 실습
### 12.3.1 CMAK를 이용한 토픽 생성
- 그냥 토픽 생성하는거 아니누?
- 근데 뭐 여기서 하는 것은 업스트림/다운스트림 카프카 연동
- 실습용 토픽 생성
    - 토픽의 상세 옵션도 설정가능

### 12.3.2 카프카 커넥트 설정
- 카프카 커넥트가 잘 실행되어 있는지 curl 명령어로 확인
- 미러 소스 커넥터를 등록(다운스트림 카프카에 있으므로 소스커넥터임)
    - 책에꺼 읽고 확인하자
    - 책에서 tasks.max 는 1로 설정함
    - 앞에서도 얘기했지만 다운스트림에 커넥터 설정함

<hr>

# Q&A
- 카프카 커넥트 복습
    - Connector, 직접 데이터를 복사하지 않고, 데이터를 어디에서 어디로 복사해야 하는지의 작업을 정의하고 관리하는 역할을 한다.
        - 소스 커넥터, 카프카로 전송할때,
        - 싱크 커넥터, 카프카에서 전송할때,
    - Task, connector가 정의한 작업을 직접 수행하는 역할을 한다. 커넥터는 데이터 전송에 관한 작업을 정의한 후 각 태스크들을 워커에 분산한다. 그런 다음 워커에 분산 배치된 태스크들을 커넥터가 정의한 작업대로 데이터를 복사
- Chapter11. Kafka Connector 미러 메이커 2.0 복습
    - 원격 토픽과 에일리어스 기능으로 Active-Active Replication 이 가능하다.
    - 카프카 클러스터 통합에 클러스터를 따로 구성할 필요가 없다.
    - 토픽 설정을 동기화할 수 있다.
    - 카프카 커넥터를 지원한다.
- Hadoop 개념
- Hbase 개념
- CMAK
    - Kafka Manager는 yahoo에서 제작한 GUI 기반 카프카 관리 도구로, 웹 환경에서 클러스터, 토픽 등의 생성 및 변경, consumer group 확인 등의 작업을 웹 환경에서 확인하고 진행할 수 있다. 사실 CLI 환경에서도 Kafka를 관리할 수 있으나 편의적인 측면에서 많은 기업들이 kafka-manager 를 도입하여 운용중이다.
    - 출처: https://server-engineer.tistory.com/759 [임대리 개발일지:티스토리]
- 주키퍼 Znode란
